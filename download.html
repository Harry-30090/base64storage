<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Reassemble & Download File</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    select, button { margin: 5px 0; padding: 10px; }
    #log { white-space: pre-wrap; background: #f4f4f4; padding: 10px; margin-top: 10px; }
  </style>
</head>
<body>
  <h2>Download & Reassemble File</h2>
  
  <p>Select a file from the repository:</p>
  <select id="fileSelect"></select>
  <br>
  <button id="fetchBtn">Fetch & Download</button>

  <h3>Logs:</h3>
  <div id="log"></div>

  <script>
    const log = (msg) => document.getElementById("log").textContent += msg + "\n";

    // ðŸ”¹ CONFIG â€” replace with your repo details
    const username = "Harry-30090";
    const repo = "base64storage";
    const branch = "main";

    // Base GitHub API URL
    const apiUrl = `https://api.github.com/repos/${username}/${repo}/contents/files?ref=${branch}`;
    const rawBase = `https://raw.githubusercontent.com/${username}/${repo}/${branch}/files/`;

    async function loadFiles() {
      log("Fetching file list...");
      try {
        const res = await fetch(apiUrl);
        if (!res.ok) throw new Error("Failed to fetch file list.");
        const data = await res.json();

        const select = document.getElementById("fileSelect");
        select.innerHTML = "";

        // Populate dropdown with folder names
        data.forEach(item => {
          if (item.type === "dir") {
            const opt = document.createElement("option");
            opt.value = item.name;
            opt.textContent = item.name;
            select.appendChild(opt);
          }
        });

        log("File list loaded.");
      } catch (err) {
        log("Error: " + err.message);
      }
    }

    document.getElementById("fetchBtn").addEventListener("click", async () => {
      const folder = document.getElementById("fileSelect").value;
      if (!folder) {
        alert("Please select a file folder!");
        return;
      }

      const indexUrl = rawBase + folder + "/index.json";

      log("Fetching index.json...");
      try {
        const res = await fetch(indexUrl);
        if (!res.ok) throw new Error("Failed to fetch index.json");
        const indexData = await res.json();

        log(`File: ${indexData.fileName}`);
        log(`Type: ${indexData.mimeType}`);
        log(`Chunks: ${indexData.totalChunks}`);

        let chunks = [];
        for (let i = 0; i < indexData.chunkFiles.length; i++) {
          const chunkUrl = rawBase + folder + "/" + indexData.chunkFiles[i];
          log(`Fetching ${chunkUrl}...`);
          const chunkRes = await fetch(chunkUrl);
          const chunkData = await chunkRes.json();
          chunks[chunkData.index] = chunkData.data;
        }

        log("Reassembling...");
        const base64 = chunks.join("");
        const blob = base64ToBlob(base64, indexData.mimeType);

        const a = document.createElement("a");
        a.href = URL.createObjectURL(blob);
        a.download = indexData.fileName;
        a.click();

        log("Download complete!");
      } catch (err) {
        log("Error: " + err.message);
      }
    });

    function base64ToBlob(base64, mimeType) {
      const byteChars = atob(base64);
      const byteNumbers = new Array(byteChars.length);
      for (let i = 0; i < byteChars.length; i++) {
        byteNumbers[i] = byteChars.charCodeAt(i);
      }
      const byteArray = new Uint8Array(byteNumbers);
      return new Blob([byteArray], { type: mimeType });
    }

    // Load file list on page load
    loadFiles();
  </script>
</body>
</html>
