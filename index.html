<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>File Split & Save to Subfolder</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    button { margin: 10px 0; padding: 10px 20px; cursor: pointer; }
    #log { white-space: pre-wrap; background: #f4f4f4; padding: 10px; }
  </style>
</head>
<body>
  <h2>File Split & Save (Base64 JSON)</h2>
  
  <input type="file" id="fileInput"><br>
  <button id="processBtn">Process File</button>
  
  <h3>Logs:</h3>
  <div id="log"></div>

  <script>
    const log = (msg) => document.getElementById("log").textContent += msg + "\n";

    document.getElementById("processBtn").addEventListener("click", async () => {
      const file = document.getElementById("fileInput").files[0];
      if (!file) {
        alert("Please select a file first!");
        return;
      }

      const fileName = file.name;
      const mimeType = file.type || "application/octet-stream";
      const baseName = fileName.replace(/\.[^/.]+$/, ""); // remove extension for folder

      log(`Reading file: ${fileName} (${file.size} bytes)`);

      const base64 = await fileToBase64(file);

      log(`Base64 length: ${base64.length}`);

      // Split into chunks of ~500 KB
      const chunkSize = 500000;
      let chunks = [];
      for (let i = 0; i < base64.length; i += chunkSize) {
        chunks.push(base64.substring(i, i + chunkSize));
      }

      log(`Split into ${chunks.length} chunks`);

      // Create index.json
      const indexJson = JSON.stringify({
        fileName,
        mimeType,
        totalChunks: chunks.length,
        chunkFiles: chunks.map((_, i) => `chunk_${i + 1}.json`)
      }, null, 2);

      // Build ZIP folder
      const zip = new JSZip();
      const folder = zip.folder(`files/${baseName}`);
      folder.file("index.json", indexJson);

      chunks.forEach((chunk, i) => {
        const json = JSON.stringify({ index: i, data: chunk });
        folder.file(`chunk_${i + 1}.json`, json);
      });

      const content = await zip.generateAsync({ type: "blob" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(content);
      a.download = `${baseName}_chunks.zip`;
      a.click();

      log("ZIP with chunks + index.json ready! Upload it to your repo.");
    });

    function fileToBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result.split(",")[1]); // strip "data:*/*;base64,"
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }
  </script>
</body>
</html>
